---
title: "California Quarto document"
format: html
echo: true
---

```{python}
import pandas as pd
from plotnine import ggplot, aes, geom_col, coord_flip, labs, theme_minimal
import matplotlib.pyplot as plt
```

```{python}
data = pd.read_csv("acs2017_county_data.csv")
data.head()
```

```{python}
print("Columns available:", list(data.columns))
```

```{python}
california_data = data[data["State"] == "California"]
print(f"Number of counties in California: {len(california_data)}")
```

```{python}
total_population = california_data["TotalPop"].sum()
mean_population = california_data["TotalPop"].mean()
largest_county_row = california_data.loc[california_data["TotalPop"].idxmax()]
largest_county = largest_county_row["County"]
largest_county_pop = largest_county_row["TotalPop"]
```

```{python}
print(f"Total population (2017): {total_population:,.0f}")
print(f"Average county population: {mean_population:,.0f}")
print(f"Largest county: {largest_county} ({largest_county_pop:,.0f} people)")
```

```{python}
from plotnine import theme, element_text

(
    ggplot(california_data.sort_values("TotalPop"), aes(x="County", y="TotalPop")) +
    geom_col(fill="#007d79") +
    coord_flip() +
    labs(
        title="Population by County - California (2017)",
        x="County",
        y="Population"
    ) +
    theme_minimal() +
    theme(
        figure_size=(10, 14),      # make plot taller
        axis_text_y=element_text(size=10)  # smaller county names
    )
)
```

```{python}
from plotnine import ggplot, aes, geom_col, coord_flip, labs, theme_minimal, theme, position_dodge

gender_data = california_data.melt(
    id_vars=["County"],
    value_vars=["Men", "Women"],
    var_name="Gender",
    value_name="Count"
)

(
    ggplot(gender_data, aes(x="County", y="Count", fill="Gender")) +
    geom_col(position=position_dodge()) +
    coord_flip() +
    labs(
        title="Population by Gender and County - California (2017)",
        x="County",
        y="Population"
    ) +
    theme_minimal() +
    theme(figure_size=(10, 14))
)
```

```{python}
from plotnine import ggplot, aes, geom_point, labs, theme_minimal, geom_smooth

(
    ggplot(california_data, aes(x="Income", y="Poverty")) +
    geom_point(color="#007d79", alpha=0.7) +
    labs(
        title="Relationship Between Income and Poverty - California (2017)",
        x="Median Household Income (USD)",
        y="Poverty Rate (%)"
    ) +
    theme_minimal() +
    geom_smooth(method='lm', color='gray')
)
```

```{python}
summary = (
    f"In 2017, California had a total population of {total_population:,.0f}, "
    f"with an average county population of {mean_population:,.0f}. "
    f"The most populous county was {largest_county} with {largest_county_pop:,.0f} residents."
)
print(summary)
```
